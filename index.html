<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookmarks</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
      min-height: 100vh;
      padding: 3rem 1rem;
    }

    .container {
      width: 50%;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      font-weight: 600;
      color: #e6edf3;
      margin-bottom: 2.5rem;
      letter-spacing: -0.02em;
    }

    h1 .accent {
      color: #3ddba9;
    }

    .category {
      margin-bottom: 2rem;
    }

    .category h2 {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #3ddba9;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #1b2432;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 0.75rem;
    }

    .bookmark {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 0.5rem;
      border-radius: 10px;
      background: #161b22;
      border: 1px solid #21262d;
      text-decoration: none;
      color: #c9d1d9;
      transition: background 0.15s, border-color 0.15s, transform 0.15s;
    }

    .bookmark:hover {
      background: #1c2633;
      border-color: #3ddba9;
      transform: translateY(-2px);
    }

    .bookmark img {
      width: 32px;
      height: 32px;
      border-radius: 6px;
    }

    .bookmark span {
      font-size: 0.75rem;
      text-align: center;
      line-height: 1.3;
      word-break: break-word;
    }

    .loading {
      text-align: center;
      color: #484f58;
      padding: 4rem 0;
    }

    @media (max-width: 1200px) {
      .container { width: 65%; }
    }

    @media (max-width: 768px) {
      .container { width: 90%; }
      .grid {
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><span class="accent">/</span> Bookmarks</h1>
    <div id="content"><p class="loading">Loading bookmarks…</p></div>
  </div>

  <script>
    function faviconUrl(siteUrl) {
      try {
        const domain = new URL(siteUrl).hostname;
        return `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
      } catch {
        return '';
      }
    }

    function parseBookmarks(md) {
      const categories = [];
      const sections = md.split(/^## /m).filter(s => s.trim());

      for (const section of sections) {
        const lines = section.split('\n');
        const name = lines[0].trim();
        const bookmarks = [];

        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].trim();
          const match = line.match(/^-\s*\[(.+?)\]\((.+?)\)\s*(icon:(\S+))?/);
          if (match) {
            const [, title, url, , customIcon] = match;
            bookmarks.push({
              title,
              url,
              icon: customIcon || faviconUrl(url),
            });
          }
        }

        if (bookmarks.length > 0) {
          categories.push({ name, bookmarks });
        }
      }

      return categories;
    }

    function render(categories) {
      const container = document.getElementById('content');
      container.innerHTML = '';

      for (const cat of categories) {
        const section = document.createElement('div');
        section.className = 'category';

        const heading = document.createElement('h2');
        heading.textContent = cat.name;
        section.appendChild(heading);

        const grid = document.createElement('div');
        grid.className = 'grid';

        for (const bm of cat.bookmarks) {
          const a = document.createElement('a');
          a.className = 'bookmark';
          a.href = bm.url;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';

          const img = document.createElement('img');
          img.src = bm.icon;
          img.alt = '';
          img.loading = 'lazy';
          img.onerror = function () {
            this.style.display = 'none';
          };

          const span = document.createElement('span');
          span.textContent = bm.title;

          a.appendChild(img);
          a.appendChild(span);
          grid.appendChild(a);
        }

        section.appendChild(grid);
        container.appendChild(section);
      }
    }

    fetch('bookmarks.md')
      .then(r => {
        if (!r.ok) throw new Error(r.status);
        return r.text();
      })
      .then(md => {
        const cats = parseBookmarks(md);
        if (cats.length === 0) throw new Error('empty');
        render(cats);
      })
      .catch(() => {
        const hint = location.protocol === 'file:'
          ? 'Serve over HTTP — e.g. <code>npx serve .</code>'
          : 'Could not load bookmarks.md';
        document.getElementById('content').innerHTML =
          `<p class="loading">${hint}</p>`;
      });
  </script>
</body>
</html>
